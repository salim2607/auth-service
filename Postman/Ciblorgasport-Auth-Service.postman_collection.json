{
    "info": {
      "_postman_id": "ciblorgasport-auth-service",
      "name": "Ciblorgasport Auth Service",
      "description": "Collection pour tester le service d'authentification Ciblorgasport",
      "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
    },
    "item": [
      {
        "name": "Environment Setup",
        "item": [
          {
            "name": "Set Base URL",
            "event": [
              {
                "listen": "test",
                "script": {
                  "exec": [
                    "pm.environment.set(\"baseUrl\", \"http://localhost:8081\");",
                    "console.log(\"Base URL set to: \" + pm.environment.get(\"baseUrl\"));"
                  ],
                  "type": "text/javascript"
                }
              }
            ],
            "request": {
              "method": "GET",
              "header": [],
              "url": {
                "raw": "{{baseUrl}}",
                "host": ["{{baseUrl}}"]
              }
            },
            "response": []
          }
        ]
      },
      {
        "name": "Public Endpoints",
        "item": [
          {
            "name": "Hello World",
            "request": {
              "method": "GET",
              "header": [],
              "url": {
                "raw": "{{baseUrl}}/auth/hello",
                "host": ["{{baseUrl}}"],
                "path": ["auth", "hello"]
              }
            },
            "response": []
          },
          {
            "name": "Register - User Normal",
            "request": {
              "method": "POST",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": {
                "mode": "raw",
                "raw": "{\n    \"username\": \"user.normal\",\n    \"email\": \"user.normal@example.com\",\n    \"password\": \"Password123!\",\n    \"role\": \"USER\"\n}"
              },
              "url": {
                "raw": "{{baseUrl}}/auth/register",
                "host": ["{{baseUrl}}"],
                "path": ["auth", "register"]
              }
            },
            "response": []
          },
          {
            "name": "Register - Athlète",
            "request": {
              "method": "POST",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": {
                "mode": "raw",
                "raw": "{\n    \"username\": \"athlete.sportif\",\n    \"email\": \"athlete@example.com\",\n    \"password\": \"Athlete123!\",\n    \"role\": \"ATHLETE\"\n}"
              },
              "url": {
                "raw": "{{baseUrl}}/auth/register",
                "host": ["{{baseUrl}}"],
                "path": ["auth", "register"]
              }
            },
            "response": []
          },
          {
            "name": "Register - Commissaire",
            "request": {
              "method": "POST",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": {
                "mode": "raw",
                "raw": "{\n    \"username\": \"commissaire.jean\",\n    \"email\": \"commissaire@example.com\",\n    \"password\": \"Commissaire123!\",\n    \"role\": \"COMMISSAIRE\"\n}"
              },
              "url": {
                "raw": "{{baseUrl}}/auth/register",
                "host": ["{{baseUrl}}"],
                "path": ["auth", "register"]
              }
            },
            "response": []
          },
          {
            "name": "Register - Volontaire",
            "request": {
              "method": "POST",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": {
                "mode": "raw",
                "raw": "{\n    \"username\": \"volontaire.marie\",\n    \"email\": \"volontaire@example.com\",\n    \"password\": \"Volontaire123!\",\n    \"role\": \"VOLONTAIRE\"\n}"
              },
              "url": {
                "raw": "{{baseUrl}}/auth/register",
                "host": ["{{baseUrl}}"],
                "path": ["auth", "register"]
              }
            },
            "response": []
          },
          {
            "name": "Register - Admin",
            "request": {
              "method": "POST",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": {
                "mode": "raw",
                "raw": "{\n    \"username\": \"admin.system\",\n    \"email\": \"admin@example.com\",\n    \"password\": \"AdminSecure123!\",\n    \"role\": \"ADMIN\"\n}"
              },
              "url": {
                "raw": "{{baseUrl}}/auth/register",
                "host": ["{{baseUrl}}"],
                "path": ["auth", "register"]
              }
            },
            "response": []
          }
        ]
      },
      {
        "name": "Authentication",
        "item": [
          {
            "name": "Login - User Normal",
            "event": [
              {
                "listen": "test",
                "script": {
                  "exec": [
                    "var jsonData = pm.response.json();",
                    "if (jsonData.token) {",
                    "    pm.environment.set(\"userToken\", jsonData.token);",
                    "    pm.environment.set(\"userRole\", jsonData.role);",
                    "    pm.environment.set(\"userUsername\", jsonData.username);",
                    "    console.log(\"Token saved for user: \" + jsonData.username);",
                    "}"
                  ],
                  "type": "text/javascript"
                }
              }
            ],
            "request": {
              "method": "POST",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": {
                "mode": "raw",
                "raw": "{\n    \"username\": \"user.normal\",\n    \"password\": \"Password123!\"\n}"
              },
              "url": {
                "raw": "{{baseUrl}}/auth/login",
                "host": ["{{baseUrl}}"],
                "path": ["auth", "login"]
              }
            },
            "response": []
          },
          {
            "name": "Login - Admin",
            "event": [
              {
                "listen": "test",
                "script": {
                  "exec": [
                    "var jsonData = pm.response.json();",
                    "if (jsonData.token) {",
                    "    pm.environment.set(\"adminToken\", jsonData.token);",
                    "    pm.environment.set(\"adminRole\", jsonData.role);",
                    "    console.log(\"Token saved for admin\");",
                    "}"
                  ],
                  "type": "text/javascript"
                }
              }
            ],
            "request": {
              "method": "POST",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": {
                "mode": "raw",
                "raw": "{\n    \"username\": \"admin.system\",\n    \"password\": \"AdminSecure123!\"\n}"
              },
              "url": {
                "raw": "{{baseUrl}}/auth/login",
                "host": ["{{baseUrl}}"],
                "path": ["auth", "login"]
              }
            },
            "response": []
          },
          {
            "name": "Login - Commissaire (non validé - devrait échouer)",
            "request": {
              "method": "POST",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": {
                "mode": "raw",
                "raw": "{\n    \"username\": \"commissaire.jean\",\n    \"password\": \"Commissaire123!\"\n}"
              },
              "url": {
                "raw": "{{baseUrl}}/auth/login",
                "host": ["{{baseUrl}}"],
                "path": ["auth", "login"]
              }
            },
            "response": []
          },
          {
            "name": "Login - Mauvais mot de passe",
            "request": {
              "method": "POST",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": {
                "mode": "raw",
                "raw": "{\n    \"username\": \"user.normal\",\n    \"password\": \"WrongPassword\"\n}"
              },
              "url": {
                "raw": "{{baseUrl}}/auth/login",
                "host": ["{{baseUrl}}"],
                "path": ["auth", "login"]
              }
            },
            "response": []
          }
        ]
      },
      {
        "name": "Endpoints Protégés - Utilisateur",
        "item": [
          {
            "name": "Get User Profile (avec token)",
            "request": {
              "method": "GET",
              "header": [
                {
                  "key": "Authorization",
                  "value": "Bearer {{userToken}}"
                }
              ],
              "url": {
                "raw": "{{baseUrl}}/api/user/profile",
                "host": ["{{baseUrl}}"],
                "path": ["api", "user", "profile"]
              }
            },
            "response": []
          },
          {
            "name": "Upload Documents (exemple)",
            "request": {
              "method": "POST",
              "header": [
                {
                  "key": "Authorization",
                  "value": "Bearer {{userToken}}"
                },
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": {
                "mode": "raw",
                "raw": "{\n    \"documents\": [\n        \"carte_identite.pdf\",\n        \"certificat_medical.pdf\"\n    ]\n}"
              },
              "url": {
                "raw": "{{baseUrl}}/api/user/upload-documents",
                "host": ["{{baseUrl}}"],
                "path": ["api", "user", "upload-documents"]
              }
            },
            "response": []
          }
        ]
      },
      {
        "name": "Endpoints Protégés - Admin",
        "item": [
          {
            "name": "Get All Users (Admin seulement)",
            "request": {
              "method": "GET",
              "header": [
                {
                  "key": "Authorization",
                  "value": "Bearer {{adminToken}}"
                }
              ],
              "url": {
                "raw": "{{baseUrl}}/api/admin/users",
                "host": ["{{baseUrl}}"],
                "path": ["api", "admin", "users"]
              }
            },
            "response": []
          },
          {
            "name": "Validate User (Admin seulement)",
            "request": {
              "method": "PUT",
              "header": [
                {
                  "key": "Authorization",
                  "value": "Bearer {{adminToken}}"
                },
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": {
                "mode": "raw",
                "raw": "{\n    \"userId\": 3,\n    \"validated\": true\n}"
              },
              "url": {
                "raw": "{{baseUrl}}/api/admin/validate-user",
                "host": ["{{baseUrl}}"],
                "path": ["api", "admin", "validate-user"]
              }
            },
            "response": []
          },
          {
            "name": "Change User Role (Admin seulement)",
            "request": {
              "method": "PUT",
              "header": [
                {
                  "key": "Authorization",
                  "value": "Bearer {{adminToken}}"
                },
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": {
                "mode": "raw",
                "raw": "{\n    \"userId\": 2,\n    \"newRole\": \"ATHLETE\"\n}"
              },
              "url": {
                "raw": "{{baseUrl}}/api/admin/change-role",
                "host": ["{{baseUrl}}"],
                "path": ["api", "admin", "change-role"]
              }
            },
            "response": []
          }
        ]
      },
      {
        "name": "Tests de Sécurité",
        "item": [
          {
            "name": "Accès Admin sans token",
            "request": {
              "method": "GET",
              "header": [],
              "url": {
                "raw": "{{baseUrl}}/api/admin/users",
                "host": ["{{baseUrl}}"],
                "path": ["api", "admin", "users"]
              }
            },
            "response": []
          },
          {
            "name": "Accès Admin avec token utilisateur normal",
            "request": {
              "method": "GET",
              "header": [
                {
                  "key": "Authorization",
                  "value": "Bearer {{userToken}}"
                }
              ],
              "url": {
                "raw": "{{baseUrl}}/api/admin/users",
                "host": ["{{baseUrl}}"],
                "path": ["api", "admin", "users"]
              }
            },
            "response": []
          },
          {
            "name": "Accès User sans token",
            "request": {
              "method": "GET",
              "header": [],
              "url": {
                "raw": "{{baseUrl}}/api/user/profile",
                "host": ["{{baseUrl}}"],
                "path": ["api", "user", "profile"]
              }
            },
            "response": []
          }
        ]
      }
    ],
    "event": [
      {
        "listen": "prerequest",
        "script": {
          "type": "text/javascript",
          "exec": [
            "if (!pm.environment.get(\"baseUrl\")) {",
            "    pm.environment.set(\"baseUrl\", \"http://localhost:8081\");",
            "}"
          ]
        }
      }
    ],
    "variable": [
      {
        "id": "base_url",
        "key": "baseUrl",
        "value": "http://localhost:8081",
        "type": "string"
      }
    ]
  }